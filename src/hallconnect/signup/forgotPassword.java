/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package hallconnect.signup;

import hallconnect.database.CentralController;
import hallconnect.database.DbConnection;
import hallconnect.signup.loginPage;
import hallconnect.room.RoomSelection;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.DriverManager;
import java.sql.ResultSet;
import javax.swing.JFrame;
import javax.swing.JOptionPane;

/**
 *
 * @author Lenovo
 */
public class forgotPassword extends javax.swing.JFrame {

    private CentralController controller = new CentralController();

    /**
     * Creates new form Registration
     */
    public forgotPassword() {
        initComponents();
    }

    public forgotPassword(CentralController controller) {
        this.controller = controller;
        initComponents();

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        panel_parent = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        label_hallconnect1 = new javax.swing.JLabel();
        btn_submit = new javax.swing.JButton();
        jPanel3 = new javax.swing.JPanel();
        label_home6 = new javax.swing.JLabel();
        label_home7 = new javax.swing.JLabel();
        txt_answer = new javax.swing.JTextField();
        combo_question = new javax.swing.JComboBox<>();
        jPanel6 = new javax.swing.JPanel();
        label_home27 = new javax.swing.JLabel();
        label_home8 = new javax.swing.JLabel();
        txt_username = new javax.swing.JTextField();
        label_home9 = new javax.swing.JLabel();
        label_home10 = new javax.swing.JLabel();
        txt_conpass = new javax.swing.JPasswordField();
        txt_pass = new javax.swing.JPasswordField();
        btn_back = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        panel_parent.setBackground(new java.awt.Color(0, 51, 51));
        panel_parent.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED));
        panel_parent.setForeground(new java.awt.Color(255, 255, 255));
        panel_parent.setPreferredSize(new java.awt.Dimension(1536, 800));
        panel_parent.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jPanel1.setBackground(new java.awt.Color(0, 153, 153));

        label_hallconnect1.setFont(new java.awt.Font("Arial Black", 1, 48)); // NOI18N
        label_hallconnect1.setForeground(new java.awt.Color(255, 255, 255));
        label_hallconnect1.setText("HallConnect");

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(584, 584, 584)
                .addComponent(label_hallconnect1, javax.swing.GroupLayout.PREFERRED_SIZE, 353, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(603, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(34, 34, 34)
                .addComponent(label_hallconnect1, javax.swing.GroupLayout.PREFERRED_SIZE, 54, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(52, Short.MAX_VALUE))
        );

        panel_parent.add(jPanel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1540, 140));

        btn_submit.setBackground(new java.awt.Color(102, 102, 102));
        btn_submit.setFont(new java.awt.Font("Arial Black", 1, 24)); // NOI18N
        btn_submit.setForeground(new java.awt.Color(255, 255, 255));
        btn_submit.setIcon(new javax.swing.ImageIcon(getClass().getResource("/hallconnect/icons/signup.png"))); // NOI18N
        btn_submit.setText("SUBMIT");
        btn_submit.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 153, 204), 3, true));
        btn_submit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_submitActionPerformed(evt);
            }
        });
        panel_parent.add(btn_submit, new org.netbeans.lib.awtextra.AbsoluteConstraints(550, 640, 170, 54));

        jPanel3.setBackground(new java.awt.Color(0, 51, 51));
        jPanel3.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.LOWERED));
        jPanel3.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        label_home6.setFont(new java.awt.Font("Arial Black", 1, 24)); // NOI18N
        label_home6.setForeground(new java.awt.Color(255, 255, 255));
        label_home6.setText("question:");
        jPanel3.add(label_home6, new org.netbeans.lib.awtextra.AbsoluteConstraints(210, 180, 170, 30));

        label_home7.setFont(new java.awt.Font("Arial Black", 1, 24)); // NOI18N
        label_home7.setForeground(new java.awt.Color(255, 255, 255));
        label_home7.setText("con-password:");
        jPanel3.add(label_home7, new org.netbeans.lib.awtextra.AbsoluteConstraints(140, 330, 210, 30));

        txt_answer.setFont(new java.awt.Font("Arial", 0, 24)); // NOI18N
        jPanel3.add(txt_answer, new org.netbeans.lib.awtextra.AbsoluteConstraints(360, 230, 430, 40));

        combo_question.setFont(new java.awt.Font("Arial", 0, 24)); // NOI18N
        combo_question.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "What is your favorite pet's name?", "What is your favorite color?", "What is your favorite food?", "What is your favorite movie?", "What is your favorite book?", "What is your mother's maiden name?", "What city were you born in?", "What was your childhood nickname?" }));
        jPanel3.add(combo_question, new org.netbeans.lib.awtextra.AbsoluteConstraints(360, 170, 430, 40));

        jPanel6.setBackground(new java.awt.Color(0, 51, 51));
        jPanel6.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.LOWERED));

        label_home27.setFont(new java.awt.Font("Arial Black", 1, 28)); // NOI18N
        label_home27.setForeground(new java.awt.Color(255, 255, 255));
        label_home27.setText("Select Your Security Question & Give Correct Answer");

        javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel6Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(label_home27)
                .addGap(99, 99, 99))
        );
        jPanel6Layout.setVerticalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addGap(16, 16, 16)
                .addComponent(label_home27, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(20, Short.MAX_VALUE))
        );

        jPanel3.add(jPanel6, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 30, 880, 70));

        label_home8.setFont(new java.awt.Font("Arial Black", 1, 24)); // NOI18N
        label_home8.setForeground(new java.awt.Color(255, 255, 255));
        label_home8.setText("username:");
        jPanel3.add(label_home8, new org.netbeans.lib.awtextra.AbsoluteConstraints(190, 130, 150, 30));

        txt_username.setFont(new java.awt.Font("Arial", 0, 24)); // NOI18N
        jPanel3.add(txt_username, new org.netbeans.lib.awtextra.AbsoluteConstraints(360, 120, 430, 40));

        label_home9.setFont(new java.awt.Font("Arial Black", 1, 24)); // NOI18N
        label_home9.setForeground(new java.awt.Color(255, 255, 255));
        label_home9.setText("answer:");
        jPanel3.add(label_home9, new org.netbeans.lib.awtextra.AbsoluteConstraints(230, 230, 150, 30));

        label_home10.setFont(new java.awt.Font("Arial Black", 1, 24)); // NOI18N
        label_home10.setForeground(new java.awt.Color(255, 255, 255));
        label_home10.setText("new-password:");
        jPanel3.add(label_home10, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 290, 210, 30));

        txt_conpass.setFont(new java.awt.Font("Arial", 0, 24)); // NOI18N
        jPanel3.add(txt_conpass, new org.netbeans.lib.awtextra.AbsoluteConstraints(360, 330, 430, 40));

        txt_pass.setFont(new java.awt.Font("Arial", 0, 24)); // NOI18N
        jPanel3.add(txt_pass, new org.netbeans.lib.awtextra.AbsoluteConstraints(360, 280, 430, 40));

        panel_parent.add(jPanel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(270, 170, 970, 420));

        btn_back.setBackground(new java.awt.Color(102, 102, 102));
        btn_back.setFont(new java.awt.Font("Arial Black", 1, 24)); // NOI18N
        btn_back.setForeground(new java.awt.Color(255, 255, 255));
        btn_back.setIcon(new javax.swing.ImageIcon(getClass().getResource("/hallconnect/icons/back1.png"))); // NOI18N
        btn_back.setText("BACK");
        btn_back.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 153, 204), 3, true));
        btn_back.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_backActionPerformed(evt);
            }
        });
        panel_parent.add(btn_back, new org.netbeans.lib.awtextra.AbsoluteConstraints(750, 640, 140, 54));

        getContentPane().add(panel_parent, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1550, 800));

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void btn_submitActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_submitActionPerformed

        String username = txt_username.getText();
        String question = combo_question.getSelectedItem().toString();
        String ans = txt_answer.getText();
        String new_pass = txt_pass.getText();
        String conPass = txt_conpass.getText();
        if (!conPass.equals(new_pass)) {
            JOptionPane.showMessageDialog(this, "Password didn't matched");
        } else {

            try {
                Connection con = DbConnection.getConnection();
                PreparedStatement pst = con.prepareStatement("select * from student where username=? AND question=? AND ans=?");
                pst.setString(1, username);
                pst.setString(2, question);
                pst.setString(3, ans);
                ResultSet rs = pst.executeQuery();
                if(rs.next()){
                    try {
                    PreparedStatement pst2 = con.prepareStatement("update student set pass=? where username=?");
                    pst2.setString(1, conPass);
                    pst2.setString(2, username);
            int rowsUpdated = pst2.executeUpdate();
               if(rowsUpdated>0){
               JOptionPane.showMessageDialog(this, "Password Changed Successfully");
               loginPage lg = new loginPage();
               lg.setVisible(true);
               this.dispose();
               }
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }else{
                JOptionPane.showMessageDialog(this, "The username,security question and password didn't matched");
                }
            } catch (Exception e) {
                e.printStackTrace();
            }

        }

    }//GEN-LAST:event_btn_submitActionPerformed

    private void btn_backActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_backActionPerformed
        // TODO add your handling code here:

        JFrame prev = controller.prevFrame();
        prev.setVisible(true);
        this.setVisible(false);
    }//GEN-LAST:event_btn_backActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(forgotPassword.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(forgotPassword.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(forgotPassword.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(forgotPassword.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new forgotPassword().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btn_back;
    private javax.swing.JButton btn_submit;
    private javax.swing.JComboBox<String> combo_question;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JLabel label_hallconnect1;
    private javax.swing.JLabel label_home10;
    private javax.swing.JLabel label_home27;
    private javax.swing.JLabel label_home6;
    private javax.swing.JLabel label_home7;
    private javax.swing.JLabel label_home8;
    private javax.swing.JLabel label_home9;
    private javax.swing.JPanel panel_parent;
    private javax.swing.JTextField txt_answer;
    private javax.swing.JPasswordField txt_conpass;
    private javax.swing.JPasswordField txt_pass;
    private javax.swing.JTextField txt_username;
    // End of variables declaration//GEN-END:variables
}
